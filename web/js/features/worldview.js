/**
 * ä¸–ç•Œè§‚ç®¡ç†ç³»ç»Ÿ
 * é¢„è®¾æ¨¡æ¿ + ç”¨æˆ·è‡ªå®šä¹‰
 */
const WorldviewManager = (function() {
    const STORAGE_KEY = 'ollama_worldviews';
    
    const defaultWorldviews = [
        {
            id: 'fantasy',
            name: 'ðŸŒŸ å¥‡å¹»é­”æ³•å¤§é™†',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªå……æ»¡é­”æ³•çš„å¥‡å¹»ä¸–ç•Œã€‚è¿™é‡Œæœ‰å„ç§ç§æ—ï¼šäººç±»ã€ç²¾çµã€çŸ®äººã€å…½äººã€é¾™è£”ã€‚é­”æ³•æ˜¯çœŸå®žå­˜åœ¨çš„ï¼Œåˆ†ä¸ºå…ƒç´ é­”æ³•ã€å¥¥æœ¯é­”æ³•ã€ç¥žåœ£é­”æ³•ç­‰ä¸åŒæ´¾ç³»ã€‚çŽ‹å›½ã€åŸŽé‚¦ã€å¸å›½å¹¶å­˜ï¼Œå†’é™©è€…å…¬ä¼šæ˜¯æœ€é‡è¦çš„ç»„ç»‡ä¹‹ä¸€ã€‚'
        },
        {
            id: 'scifi',
            name: 'ðŸ¤– èµ›åšæœ‹å…‹æœªæ¥',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªé«˜ç§‘æŠ€ä½†ç¤¾ä¼šç§©åºå´©å¡Œçš„æœªæ¥ä¸–ç•Œã€‚å·¨åž‹ corporations ç»Ÿæ²»ç€åŸŽå¸‚ï¼Œéœ“è™¹ç¯ç…§äº®å¤œç©ºä¹‰ä½“æ”¹é€ ã€è™šæ‹ŸçŽ°å®žã€äººå·¥æ™ºèƒ½æ˜¯è¿™ä¸ªæ—¶ä»£çš„ä¸»æ—‹å¾‹ã€‚è´«æ°‘çªŸå’Œé«˜å¡”å¹¶å­˜ï¼Œè¡—å¤´å¸®æ´¾ã€ä¼ä¸šç‰¹å·¥ã€é»‘å®¢æ˜¯å¸¸è§çš„è§’è‰²ã€‚'
        },
        {
            id: 'modern',
            name: 'ðŸ™ï¸ çŽ°ä»£éƒ½å¸‚',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªè´´è¿‘çŽ°å®žçš„çŽ°ä»£éƒ½å¸‚èƒŒæ™¯ã€‚æ²¡æœ‰è¶…è‡ªç„¶åŠ›é‡ï¼Œä¹Ÿæ²¡æœ‰é«˜ç§‘æŠ€åˆ°ç¦»è°±çš„è®¾å¤‡ã€‚è¿™é‡Œæ˜¯æ—¥å¸¸ç”Ÿæ´»çš„èˆžå°ï¼šå·¥ä½œã€ç¤¾äº¤ã€æ„Ÿæƒ…ã€æ¢¦æƒ³ã€å›°æƒ‘...ä¸€åˆ‡éƒ½é‚£ä¹ˆçœŸå®žï¼Œé‚£ä¹ˆè§¦æ‰‹å¯åŠã€‚'
        },
        {
            id: 'wuxia',
            name: 'âš”ï¸ æ­¦ä¾ æ±Ÿæ¹–',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªæ©æ€¨æƒ…ä»‡çš„æ­¦ä¾ ä¸–ç•Œã€‚é—¨æ´¾æž—ç«‹ï¼Œæ±Ÿæ¹–è§„çŸ©ï¼Œæ­¦åŠŸç§˜ç±ï¼Œè½»åŠŸå†…åŠŸ...ä¾ å®¢ä»¬ä»¥æ­¦ä¼šå‹ï¼Œä»¥è¡€äº†å€ºã€‚è¿™é‡Œæœ‰é™¤æš´å®‰è‰¯ï¼Œä¹Ÿæœ‰å‹¾å¿ƒæ–—è§’ï¼›æœ‰ç»ä»£ä½³äººï¼Œä¹Ÿæœ‰æµªå­å›žå¤´ã€‚ä¸€æŠŠå‰‘ï¼Œä¸€å£¶é…’ï¼Œå°±æ˜¯æ•´ä¸ªæ±Ÿæ¹–ã€‚'
        },
        {
            id: 'space',
            name: 'ðŸš€ æ˜Ÿé™…ç§‘å¹»',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªæ˜Ÿé™…æ–‡æ˜Žæ—¶ä»£ã€‚äººç±»å·²ç»çªç ´åœ°çƒæ‘‡ç¯®ï¼Œåœ¨é“¶æ²³ç³»ä¸­å¼€ç–†æ‹“åœŸã€‚æ›²é€Ÿèˆªè¡Œã€æ˜Ÿé™…è´¸æ˜“ã€å¤–æ˜Ÿæ–‡æ˜Žã€å¤šç»´ç§æ—...å®‡å®™çš„å¹¿è¢¤è¶…ä¹Žæƒ³è±¡ã€‚å¤ªç©ºç«™ã€æ˜Ÿé™…é£žèˆ¹ã€æ®–æ°‘æ˜Ÿçƒæ˜¯è¿™ä¸ªæ—¶ä»£çš„æ ‡å¿—ã€‚'
        },
        {
            id: 'horror',
            name: 'ðŸ‘» éƒ½å¸‚æ€ªè°ˆ',
            content: 'ã€ä¸–ç•Œè§‚ã€‘ä½ å¤„åœ¨ä¸€ä¸ªçœ‹ä¼¼æ­£å¸¸ä½†æš—æµæ¶ŒåŠ¨çš„ä¸–ç•Œã€‚éƒ½å¸‚ä¼ è¯´ã€çµå¼‚äº‹ä»¶ã€æœªçŸ¥å­˜åœ¨...æœ‰äº›äº‹æƒ…ç§‘å­¦æ— æ³•è§£é‡Šã€‚åºŸå¼ƒçš„å»ºç­‘ã€å¤œåŠçš„æ•²é—¨å£°ã€æ¶ˆå¤±çš„è®°å¿†...ä½ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€ä¸ªè½¬è§’ä¼šé‡åˆ°ä»€ä¹ˆã€‚'
        }
    ];
    
    function getAll() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const custom = JSON.parse(saved);
                return [...defaultWorldviews, ...custom];
            }
        } catch (e) {
            console.error('åŠ è½½ä¸–ç•Œè§‚å¤±è´¥:', e);
        }
        return defaultWorldviews;
    }
    
    function add(worldview) {
        const all = getAll();
        const newWorldview = {
            id: 'custom_' + Date.now(),
            name: worldview.name || 'è‡ªå®šä¹‰ä¸–ç•Œè§‚',
            content: worldview.content || '',
            isCustom: true
        };
        all.push(newWorldview);
        
        const customList = all.filter(w => w.isCustom);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(customList));
        
        return newWorldview;
    }
    
    function remove(id) {
        const all = getAll();
        const filtered = all.filter(w => w.id !== id);
        
        const customList = filtered.filter(w => w.isCustom);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(customList));
    }
    
    function getById(id) {
        return getAll().find(w => w.id === id);
    }
    
    return {
        getAll,
        add,
        remove,
        getById
    };
})();
